{% extends "admin/base.html" %} {% block title %}Produits{% endblock %} {% block page_title %}Gestion des produits{% endblock %} {% block content %}
<!-- Header avec recherche et bouton -->
<div class="flex items-center justify-between mb-6 gap-4">
  <div class="flex-1 max-w-md">
    <div class="relative">
      <input
        type="text"
        id="search-products"
        placeholder="Rechercher un produit..."
        class="w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"
      />
      <svg class="w-5 h-5 text-gray-400 absolute left-3 top-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
    </div>
  </div>
  <button id="create-product-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center gap-2 whitespace-nowrap">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
    </svg>
    Nouveau produit
  </button>
</div>

<!-- Filtres -->
<div class="mb-6 flex gap-3">
  <select class="px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
    <option>Toutes les catégories</option>
    <option>Décoration</option>
    <option>Mobilier</option>
    <option>Luminaires</option>
    <option>Textile</option>
  </select>
  <select class="px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
    <option>Tous les statuts</option>
    <option>En ligne</option>
    <option>Brouillon</option>
    <option>Rupture de stock</option>
  </select>
</div>

<!-- Liste des produits en grille -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="products-grid">
  <!-- Produit 1 -->
  <div class="bg-white rounded-lg shadow hover:shadow-lg transition-shadow cursor-pointer product-card" data-product-id="1">
    <div class="aspect-square bg-gray-100 rounded-t-lg overflow-hidden">
      <img src="https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=400" alt="Vase céramique" class="w-full h-full object-cover" />
    </div>
    <div class="p-4">
      <div class="flex items-start justify-between mb-2">
        <h3 class="font-semibold text-gray-900">Vase céramique artisanal</h3>
        <span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">En ligne</span>
      </div>
      <p class="text-sm text-gray-500 mb-3">Décoration</p>
      <div class="flex items-center justify-between">
        <span class="text-lg font-bold text-gray-900">45,00 €</span>
        <span class="text-sm text-gray-600">Stock: 12</span>
      </div>
    </div>
  </div>

  <!-- Produit 2 -->
  <div class="bg-white rounded-lg shadow hover:shadow-lg transition-shadow cursor-pointer product-card" data-product-id="2">
    <div class="aspect-square bg-gray-100 rounded-t-lg overflow-hidden">
      <img src="https://images.unsplash.com/photo-1602874801006-c8f8f5f0e42f?w=400" alt="Bougie" class="w-full h-full object-cover" />
    </div>
    <div class="p-4">
      <div class="flex items-start justify-between mb-2">
        <h3 class="font-semibold text-gray-900">Bougie parfumée artisanale</h3>
        <span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">En ligne</span>
      </div>
      <p class="text-sm text-gray-500 mb-3">Décoration</p>
      <div class="flex items-center justify-between">
        <span class="text-lg font-bold text-gray-900">28,00 €</span>
        <span class="text-sm text-gray-600">Stock: 24</span>
      </div>
    </div>
  </div>

  <!-- Produit 3 -->
  <div class="bg-white rounded-lg shadow hover:shadow-lg transition-shadow cursor-pointer product-card" data-product-id="3">
    <div class="aspect-square bg-gray-100 rounded-t-lg overflow-hidden">
      <img src="https://images.unsplash.com/photo-1566301363515-d0e24e8a5ef7?w=400" alt="Coussin" class="w-full h-full object-cover" />
    </div>
    <div class="p-4">
      <div class="flex items-start justify-between mb-2">
        <h3 class="font-semibold text-gray-900">Coussin en lin naturel</h3>
        <span class="px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800">Stock bas</span>
      </div>
      <p class="text-sm text-gray-500 mb-3">Textile</p>
      <div class="flex items-center justify-between">
        <span class="text-lg font-bold text-gray-900">35,00 €</span>
        <span class="text-sm text-red-600">Stock: 2</span>
      </div>
    </div>
  </div>

  <!-- Produit 4 -->
  <div class="bg-white rounded-lg shadow hover:shadow-lg transition-shadow cursor-pointer product-card" data-product-id="4">
    <div class="aspect-square bg-gray-100 rounded-t-lg overflow-hidden flex items-center justify-center">
      <svg class="w-20 h-20 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
        />
      </svg>
    </div>
    <div class="p-4">
      <div class="flex items-start justify-between mb-2">
        <h3 class="font-semibold text-gray-900">Lampe de table moderne</h3>
        <span class="px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800">Brouillon</span>
      </div>
      <p class="text-sm text-gray-500 mb-3">Luminaires</p>
      <div class="flex items-center justify-between">
        <span class="text-lg font-bold text-gray-900">89,00 €</span>
        <span class="text-sm text-gray-600">Stock: 8</span>
      </div>
    </div>
  </div>
</div>

<!-- Modal édition produit -->
<div id="product-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
  <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
    <div class="p-6 border-b border-gray-200 flex items-center justify-between sticky top-0 bg-white">
      <h3 class="text-xl font-semibold text-gray-900" id="modal-title">Modifier le produit</h3>
      <button id="close-modal" class="text-gray-400 hover:text-gray-600">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <form id="product-form" class="p-6">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Colonne gauche : Images -->
        <div class="space-y-4">
          <h4 class="font-semibold text-gray-900 mb-4">Photos du produit</h4>

          <!-- Image principale -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Image principale *</label>
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition-colors cursor-pointer" id="main-image-upload">
              <div id="main-image-preview" class="hidden">
                <img src="" alt="Preview" class="w-full h-48 object-cover rounded mb-2" />
                <button type="button" class="text-sm text-red-600 hover:text-red-800">Supprimer</button>
              </div>
              <div id="main-image-placeholder">
                <svg class="w-12 h-12 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                  />
                </svg>
                <p class="text-sm text-gray-600">Cliquez ou glissez une image</p>
                <p class="text-xs text-gray-500 mt-1">JPG, PNG jusqu'à 5MB</p>
              </div>
              <input type="file" id="main-image-input" accept="image/*" class="hidden" />
            </div>
          </div>

          <!-- Images secondaires -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Images supplémentaires</label>
            <div class="grid grid-cols-3 gap-2" id="additional-images">
              <div class="border-2 border-dashed border-gray-300 rounded aspect-square flex items-center justify-center cursor-pointer hover:border-blue-500 transition-colors" id="add-image-btn">
                <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
              </div>
            </div>
            <input type="file" id="additional-images-input" accept="image/*" multiple class="hidden" />
          </div>
        </div>

        <!-- Colonne droite : Informations -->
        <div class="space-y-4">
          <h4 class="font-semibold text-gray-900 mb-4">Informations du produit</h4>

          <!-- Nom -->
          <div>
            <label for="product-name" class="block text-sm font-medium text-gray-700 mb-2">Nom du produit *</label>
            <input
              type="text"
              id="product-name"
              required
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"
              placeholder="Vase céramique artisanal"
            />
          </div>

          <!-- Catégorie -->
          <div>
            <label for="product-category" class="block text-sm font-medium text-gray-700 mb-2">Catégorie *</label>
            <select id="product-category" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
              <option value="">Sélectionner une catégorie</option>
              <option value="decoration">Décoration</option>
              <option value="mobilier">Mobilier</option>
              <option value="luminaires">Luminaires</option>
              <option value="textile">Textile</option>
              <option value="accessoires">Accessoires</option>
            </select>
          </div>

          <!-- Prix et Stock -->
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="product-price" class="block text-sm font-medium text-gray-700 mb-2">Prix (€) *</label>
              <input
                type="number"
                id="product-price"
                required
                min="0"
                step="0.01"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"
                placeholder="45.00"
              />
            </div>
            <div>
              <label for="product-stock" class="block text-sm font-medium text-gray-700 mb-2">Stock *</label>
              <input
                type="number"
                id="product-stock"
                required
                min="0"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"
                placeholder="12"
              />
            </div>
          </div>

          <!-- Description courte -->
          <div>
            <label for="product-short-desc" class="block text-sm font-medium text-gray-700 mb-2">Description courte</label>
            <textarea
              id="product-short-desc"
              rows="2"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 resize-none"
              placeholder="Une ligne d'accroche pour le produit..."
            ></textarea>
          </div>

          <!-- Description complète -->
          <div>
            <label for="product-description" class="block text-sm font-medium text-gray-700 mb-2">Description complète *</label>
            <textarea
              id="product-description"
              required
              rows="6"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 resize-none"
              placeholder="Décrivez votre produit en détail..."
            ></textarea>
          </div>

          <!-- Dimensions -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Dimensions</label>
            <div class="grid grid-cols-3 gap-2">
              <input type="text" id="product-width" class="px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm" placeholder="L (cm)" />
              <input type="text" id="product-height" class="px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm" placeholder="H (cm)" />
              <input type="text" id="product-depth" class="px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm" placeholder="P (cm)" />
            </div>
          </div>

          <!-- Statut -->
          <div>
            <label for="product-status" class="block text-sm font-medium text-gray-700 mb-2">Statut *</label>
            <select id="product-status" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
              <option value="online">En ligne</option>
              <option value="draft">Brouillon</option>
              <option value="out-of-stock">Rupture de stock</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Boutons -->
      <div class="flex gap-3 pt-6 mt-6 border-t border-gray-200">
        <button type="button" id="delete-product-btn" class="px-6 py-3 border border-red-300 text-red-600 rounded-lg hover:bg-red-50 transition-colors font-medium">Supprimer</button>
        <div class="flex-1"></div>
        <button type="button" id="cancel-btn" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium">Annuler</button>
        <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">Enregistrer</button>
      </div>
    </form>
  </div>
</div>
{% endblock %} {% block extra_scripts %}
<script>
  // Modal management
  const modal = document.getElementById("product-modal");
  const modalTitle = document.getElementById("modal-title");
  const createBtn = document.getElementById("create-product-btn");
  const closeModalBtn = document.getElementById("close-modal");
  const cancelBtn = document.getElementById("cancel-btn");

  // Open modal for new product
  createBtn.addEventListener("click", () => {
    modalTitle.textContent = "Nouveau produit";
    document.getElementById("product-form").reset();
    document.getElementById("delete-product-btn").classList.add("hidden");
    modal.classList.remove("hidden");
  });

  // Open modal for existing product
  document.querySelectorAll(".product-card").forEach((card) => {
    card.addEventListener("click", () => {
      const productId = card.dataset.productId;
      modalTitle.textContent = "Modifier le produit";
      document.getElementById("delete-product-btn").classList.remove("hidden");

      // TODO: Load product data
      // For now, just open modal
      modal.classList.remove("hidden");
    });
  });

  function closeModal() {
    modal.classList.add("hidden");
    document.getElementById("product-form").reset();
  }

  closeModalBtn.addEventListener("click", closeModal);
  cancelBtn.addEventListener("click", closeModal);

  // Close modal on outside click
  modal.addEventListener("click", (e) => {
    if (e.target === modal) closeModal();
  });

  // Image uploads
  const mainImageUpload = document.getElementById("main-image-upload");
  const mainImageInput = document.getElementById("main-image-input");
  const mainImagePreview = document.getElementById("main-image-preview");
  const mainImagePlaceholder = document.getElementById("main-image-placeholder");

  mainImageUpload.addEventListener("click", () => {
    mainImageInput.click();
  });

  mainImageInput.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        mainImagePreview.querySelector("img").src = e.target.result;
        mainImagePreview.classList.remove("hidden");
        mainImagePlaceholder.classList.add("hidden");
      };
      reader.readAsDataURL(file);
    }
  });

  // Additional images
  const addImageBtn = document.getElementById("add-image-btn");
  const additionalImagesInput = document.getElementById("additional-images-input");
  const additionalImagesContainer = document.getElementById("additional-images");

  addImageBtn.addEventListener("click", () => {
    additionalImagesInput.click();
  });

  additionalImagesInput.addEventListener("change", (e) => {
    Array.from(e.target.files).forEach((file) => {
      const reader = new FileReader();
      reader.onload = (e) => {
        const div = document.createElement("div");
        div.className = "border rounded aspect-square overflow-hidden relative group";
        div.innerHTML = `
        <img src="${e.target.result}" class="w-full h-full object-cover" />
        <button type="button" class="absolute top-1 right-1 bg-red-600 text-white p-1 rounded opacity-0 group-hover:opacity-100 transition-opacity remove-image">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      `;

        // Insert before add button
        additionalImagesContainer.insertBefore(div, addImageBtn);

        // Remove image
        div.querySelector(".remove-image").addEventListener("click", (e) => {
          e.stopPropagation();
          div.remove();
        });
      };
      reader.readAsDataURL(file);
    });
  });

  // Form submission
  document.getElementById("product-form").addEventListener("submit", function (e) {
    e.preventDefault();

    const formData = {
      name: document.getElementById("product-name").value,
      category: document.getElementById("product-category").value,
      price: document.getElementById("product-price").value,
      stock: document.getElementById("product-stock").value,
      shortDesc: document.getElementById("product-short-desc").value,
      description: document.getElementById("product-description").value,
      width: document.getElementById("product-width").value,
      height: document.getElementById("product-height").value,
      depth: document.getElementById("product-depth").value,
      status: document.getElementById("product-status").value,
    };

    // Simulate API call
    console.log("Saving product:", formData);

    alert("Produit enregistré avec succès !");
    closeModal();
  });

  // Delete product
  document.getElementById("delete-product-btn").addEventListener("click", function () {
    if (confirm("Êtes-vous sûr de vouloir supprimer ce produit ?")) {
      // Simulate API call
      console.log("Deleting product");
      alert("Produit supprimé !");
      closeModal();
    }
  });

  // Search
  document.getElementById("search-products").addEventListener("input", function (e) {
    const search = e.target.value.toLowerCase();
    document.querySelectorAll(".product-card").forEach((card) => {
      const text = card.textContent.toLowerCase();
      card.style.display = text.includes(search) ? "" : "none";
    });
  });
</script>
{% endblock %}
