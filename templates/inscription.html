{% extends "auth-layout.html" %} {% block title %}Inscription - Maison Manoé{% endblock %} {% block description %}Créez votre compte Maison Manoé pour profiter d'une expérience d'achat personnalisée
et suivre vos commandes.{% endblock %} {% block page_title %}Créer un compte{% endblock %} {% block page_subtitle %}Rejoignez la communauté Maison Manoé{% endblock %} {% block image_id %}inscription{%
endblock %} {% block form_content %}
<!-- Indicateur d'étapes -->
<div class="mb-8">
  <div class="flex items-center justify-center">
    <div class="flex items-center">
      <div id="step-1-indicator" class="flex items-center justify-center w-10 h-10 rounded-full bg-black text-white font-semibold">1</div>
      <div class="w-16 h-1 bg-gray-300" id="step-line"></div>
      <div id="step-2-indicator" class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 text-gray-600 font-semibold">2</div>
    </div>
  </div>
  <div class="flex justify-center gap-16 mt-2">
    <span id="step-1-label" class="text-sm font-medium text-black">Informations</span>
    <span id="step-2-label" class="text-sm text-gray-500">Sécurité</span>
  </div>
</div>

<form id="inscription-form" class="space-y-6">
  <!-- ÉTAPE 1 : Informations personnelles -->
  <div id="step-1" class="space-y-6">
    <!-- Civilité -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Civilité *</label>
      <div class="flex gap-4">
        <label class="flex items-center">
          <input type="radio" name="civilite" value="M" required class="mr-2" />
          <span>M.</span>
        </label>
        <label class="flex items-center">
          <input type="radio" name="civilite" value="Mme" required class="mr-2" />
          <span>Mme</span>
        </label>
      </div>
    </div>

    <!-- Prénom et Nom -->
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label for="prenom" class="block text-sm font-medium text-gray-700 mb-2">Prénom *</label>
        <input
          type="text"
          id="prenom"
          name="prenom"
          required
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-maison-beige focus:outline-none focus:ring-2 focus:ring-maison-beige/20"
          placeholder="Prénom"
        />
      </div>
      <div>
        <label for="nom" class="block text-sm font-medium text-gray-700 mb-2">Nom *</label>
        <input
          type="text"
          id="nom"
          name="nom"
          required
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-maison-beige focus:outline-none focus:ring-2 focus:ring-maison-beige/20"
          placeholder="Nom"
        />
      </div>
    </div>

    <!-- Email -->
    <div>
      <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
      <input
        type="email"
        id="email"
        name="email"
        required
        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-maison-beige focus:outline-none focus:ring-2 focus:ring-maison-beige/20"
        placeholder="votre@email.com"
      />
    </div>

    <!-- Téléphone -->
    <div>
      <label for="telephone" class="block text-sm font-medium text-gray-700 mb-2">Téléphone</label>
      <input
        type="tel"
        id="telephone"
        name="telephone"
        pattern="[0-9]{10}"
        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-maison-beige focus:outline-none focus:ring-2 focus:ring-maison-beige/20"
        placeholder="0123456789"
      />
      <p class="mt-1 text-xs text-gray-500">Optionnel - Format : 10 chiffres sans espaces</p>
    </div>

    <!-- Bouton Continuer -->
    <button type="button" id="next-step-btn" class="w-full px-6 py-3 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors font-medium">Continuer</button>
  </div>

  <!-- ÉTAPE 2 : Mot de passe -->
  <div id="step-2" class="space-y-6 hidden">
    <!-- Mot de passe -->
    <div>
      <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Mot de passe *</label>
      <div class="relative">
        <input
          type="password"
          id="password"
          name="password"
          required
          minlength="8"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-maison-beige focus:outline-none focus:ring-2 focus:ring-maison-beige/20"
          placeholder="Minimum 8 caractères"
        />
        <button type="button" id="toggle-password" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700" aria-label="Afficher le mot de passe">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
            />
          </svg>
        </button>
      </div>
      <div id="password-strength" class="mt-2 text-sm"></div>
    </div>

    <!-- Confirmation mot de passe -->
    <div>
      <label for="password-confirm" class="block text-sm font-medium text-gray-700 mb-2">Confirmer le mot de passe *</label>
      <input
        type="password"
        id="password-confirm"
        name="password-confirm"
        required
        minlength="8"
        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-maison-beige focus:outline-none focus:ring-2 focus:ring-maison-beige/20"
        placeholder="Confirmez votre mot de passe"
      />
      <div id="password-match" class="mt-2 text-sm"></div>
    </div>

    <!-- Newsletter -->
    <div class="flex items-start">
      <input type="checkbox" id="newsletter" name="newsletter" class="mt-1 mr-3" />
      <label for="newsletter" class="text-sm text-gray-700"> Je souhaite recevoir les nouveautés et offres exclusives par email </label>
    </div>

    <!-- CGV et confidentialité -->
    <div class="flex items-start">
      <input type="checkbox" id="accept-terms" name="accept-terms" required class="mt-1 mr-3" />
      <label for="accept-terms" class="text-sm text-gray-700">
        J'accepte les <a href="/cgv" class="text-maison-beige hover:underline">conditions générales de vente</a> et la
        <a href="/confidentialite" class="text-maison-beige hover:underline">politique de confidentialité</a> *
      </label>
    </div>

    <!-- Messages d'erreur -->
    <div id="error-message" class="hidden p-4 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm"></div>

    <!-- Boutons navigation -->
    <div class="flex gap-4">
      <button type="button" id="prev-step-btn" class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium">Retour</button>
      <button type="submit" id="submit-btn" class="flex-1 px-6 py-3 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors font-medium">
        <span id="submit-text">Créer mon compte</span>
        <span id="submit-spinner" class="hidden">
          <svg class="animate-spin h-5 w-5 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        </span>
      </button>
    </div>

    <p class="text-xs text-gray-500 text-center">* Champs obligatoires</p>
  </div>
</form>

<!-- Message de succès -->
<div id="success-message" class="hidden">
  <div class="text-center py-8">
    <div class="mb-4">
      <svg class="w-16 h-16 mx-auto text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    </div>
    <h2 class="text-2xl font-bold mb-2">Compte créé avec succès !</h2>
    <p class="text-gray-600 mb-6">Un email de confirmation vous a été envoyé.</p>
    <a href="/connexion" class="inline-block px-6 py-3 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors"> Se connecter </a>
  </div>
</div>

<script>
  // Navigation entre les étapes
  let currentStep = 1;

  function updateStepIndicators() {
    const step1Indicator = document.getElementById("step-1-indicator");
    const step2Indicator = document.getElementById("step-2-indicator");
    const step1Label = document.getElementById("step-1-label");
    const step2Label = document.getElementById("step-2-label");
    const stepLine = document.getElementById("step-line");

    if (currentStep === 1) {
      step1Indicator.className = "flex items-center justify-center w-10 h-10 rounded-full bg-black text-white font-semibold";
      step2Indicator.className = "flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 text-gray-600 font-semibold";
      step1Label.className = "text-sm font-medium text-black";
      step2Label.className = "text-sm text-gray-500";
      stepLine.className = "w-16 h-1 bg-gray-300";
    } else {
      step1Indicator.className = "flex items-center justify-center w-10 h-10 rounded-full bg-green-500 text-white font-semibold";
      step2Indicator.className = "flex items-center justify-center w-10 h-10 rounded-full bg-black text-white font-semibold";
      step1Label.className = "text-sm text-gray-500";
      step2Label.className = "text-sm font-medium text-black";
      stepLine.className = "w-16 h-1 bg-green-500";
    }
  }

  // Passer à l'étape suivante
  document.getElementById("next-step-btn").addEventListener("click", function () {
    // Validation de l'étape 1
    const civilite = document.querySelector('input[name="civilite"]:checked');
    const prenom = document.getElementById("prenom").value.trim();
    const nom = document.getElementById("nom").value.trim();
    const email = document.getElementById("email").value.trim();

    if (!civilite || !prenom || !nom || !email) {
      alert("Veuillez remplir tous les champs obligatoires.");
      return;
    }

    // Email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      alert("Veuillez entrer une adresse email valide.");
      return;
    }

    // Passer à l'étape 2
    currentStep = 2;
    document.getElementById("step-1").classList.add("hidden");
    document.getElementById("step-2").classList.remove("hidden");
    updateStepIndicators();
    window.scrollTo({ top: 0, behavior: "smooth" });
  });

  // Retour à l'étape précédente
  document.getElementById("prev-step-btn").addEventListener("click", function () {
    currentStep = 1;
    document.getElementById("step-2").classList.add("hidden");
    document.getElementById("step-1").classList.remove("hidden");
    updateStepIndicators();
    window.scrollTo({ top: 0, behavior: "smooth" });
  });

  // Toggle password visibility
  document.getElementById("toggle-password").addEventListener("click", function () {
    const passwordInput = document.getElementById("password");
    const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
    passwordInput.setAttribute("type", type);
  });

  // Password strength indicator
  document.getElementById("password").addEventListener("input", function (e) {
    const password = e.target.value;
    const strengthDiv = document.getElementById("password-strength");

    if (password.length === 0) {
      strengthDiv.innerHTML = "";
      return;
    }

    let strength = 0;
    let feedback = [];

    if (password.length >= 8) strength++;
    if (password.length >= 12) strength++;
    if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
    if (/[0-9]/.test(password)) strength++;
    if (/[^A-Za-z0-9]/.test(password)) strength++;

    const strengthText = ["Très faible", "Faible", "Moyen", "Fort", "Très fort"];
    const strengthColor = ["text-red-600", "text-orange-600", "text-yellow-600", "text-green-600", "text-green-700"];

    strengthDiv.innerHTML = `Force : <span class="${strengthColor[strength - 1]}">${strengthText[strength - 1]}</span>`;
  });

  // Password confirmation check
  document.getElementById("password-confirm").addEventListener("input", function (e) {
    const password = document.getElementById("password").value;
    const confirm = e.target.value;
    const matchDiv = document.getElementById("password-match");

    if (confirm.length === 0) {
      matchDiv.innerHTML = "";
      return;
    }

    if (password === confirm) {
      matchDiv.innerHTML = '<span class="text-green-600">✓ Les mots de passe correspondent</span>';
    } else {
      matchDiv.innerHTML = '<span class="text-red-600">✗ Les mots de passe ne correspondent pas</span>';
    }
  });

  // Form submission
  document.getElementById("inscription-form").addEventListener("submit", function (e) {
    e.preventDefault();

    const password = document.getElementById("password").value;
    const confirm = document.getElementById("password-confirm").value;
    const errorDiv = document.getElementById("error-message");

    // Validation
    if (password !== confirm) {
      errorDiv.textContent = "Les mots de passe ne correspondent pas.";
      errorDiv.classList.remove("hidden");
      return;
    }

    if (password.length < 8) {
      errorDiv.textContent = "Le mot de passe doit contenir au moins 8 caractères.";
      errorDiv.classList.remove("hidden");
      return;
    }

    // Hide error
    errorDiv.classList.add("hidden");

    // Show loading
    const submitBtn = document.getElementById("submit-btn");
    const submitText = document.getElementById("submit-text");
    const submitSpinner = document.getElementById("submit-spinner");

    submitBtn.disabled = true;
    submitText.classList.add("hidden");
    submitSpinner.classList.remove("hidden");

    // Simulate API call
    setTimeout(() => {
      // Hide form, show success
      document.getElementById("inscription-form").classList.add("hidden");
      document.getElementById("success-message").classList.remove("hidden");
    }, 2000);
  });
</script>
{% endblock %} {% block additional_links %}
<div class="mt-6 text-center text-sm text-gray-600">
  Vous avez déjà un compte ?
  <a href="/connexion" class="text-maison-beige hover:underline font-medium">Se connecter</a>
</div>
{% endblock %}
